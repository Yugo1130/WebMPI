version: "3.8"

services:
  web:
    image: nginx:latest
    container_name: nginx
    ports:
      - "8080:80"
    volumes:
      # runtime/clientをnginxのドキュメントルートにマウント（静的ファイルを配信）
      - ./runtime/client:/usr/share/nginx/html:ro
      # nginx.conf(nginxの設定ファイル)をマウント（上書き）
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro

  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: node-server
    ports:
      - "9000:9000"
      - "9001:9001"
    restart: unless-stopped

  # wasm:
  #   image: emscripten/emsdk:latest
  #   container_name: emscripten
  #   working_dir: /src
  #   volumes:
  #     # ブラウザからアップロードされた .cpp ファイルが /src/sample.cpp として参照される
  #     - ./uploads:/src:ro
  #     # emcc の出力ファイル（sample.js や sample.wasm）を /out/sample.js などとして保存
  #     # コンパイル結果が public/wasm/ に出力されて、nginx 経由で配信される
  #     - ./runtime/client/public/wasm:/out
  #     # mpi.h や mpi.c を /mpi/mpi.h として読み取り専用で参照可能に
  #     - ./mpi:/mpi:ro
  #   tty: true
  #   entrypoint: /bin/bash
